# Storage

오늘은 스토리지에 대한 전반적인 것들을 써보려고 한다. (쿠키, 웹 스토리지, 세션)

그러기에 앞서 앞에서 HTTP에 대해서 글을 썼는데, 오늘은 그것과 연결이 된다.

그러면 다시 한번 개념을 짚고 넘어가자.

한마디로 표현을 하면

```
HTTP는 클라이언트와 서버가 데이터를 주고 받기 위한 프로토콜
```

## 등장배경

HTTP는 <b>비연결성</b>과 <b>무상태성</b>에 특징을 가지고 있기 때문에
한번 서버에 요청을 하고 응답을 받으면 끊기게 된다.

\*\* 비연결성 : 클라이언트가 요청을 서버에 보내고 서버가 다시 응답을 보내면 연결을 끊는 특성

\*\* 무상태성 : 연결을 끊는 순간 통신이 끝나고 상태 정보를 유지하지 않는 특성

이러한 문제점을 해결하기 위해 쿠키, 웹스토리지, 세션이 등장을 하게 되었다.

## 쿠키

브라우저에 저장되는 key와 value로 이루어진 작은 문자열이다.

특징을 살펴보면
4kb의 크기 제한, 만료 시간 설정 가능, http 요청 시 자동으로 전달할 수 있는 특징을 가지고 있다.

단점으로는 용량이 작고, XSS, CSRF(XSRF) 공격에 취약함

이용되는 곳 : 장바구니, 로그인 유지, 오늘 이 창을 다시보지 않기 등

\*\* XSS : 악성 스크립트를 삽입하여 공격

\*\* CSRF(XSRF) : 사용자의 권한을 이용한 공격

## 쿠키 종류

쿠키 종류는 영구 쿠키와 세션 쿠키로 나뉜다.

만료기간을 정한 쿠키는 영구 쿠키이고 정하지 않으면 세션 쿠키이다.

영구 쿠키는 만료 기간이 끝난 후 삭제가 되고

세션 쿠키는 브라우저 종료 시 삭제가 된다.

같은 도메인(서브 도메인)에서 생성된 쿠키를 퍼스트파티 쿠키
다른 도메인에서 생성된 쿠키는 서드파트 쿠키로 나뉘기도 합니다.
서드파트 쿠키는 다른 도메인에서 생성된 쿠키

#### 쿠키 속성

HTTPOnly : 자바스크립트로 쿠키를 조회하는 것을 방지

SameSite

Strict : 같은 도메인 요청에만 쿠키를 전송

Lax : 쿠키 일부 허용 (HTTP GET, a href, link href)

Secure : HTTPS에서만 통신하는 경우에만 쿠키를 전송

## 쿠키 동작과정

1. 클라이언트가 서버에 요청을 하면
2. 서버에서 브라우저에 대한 정보를 쿠키에 넣고 응답과 함께 쿠키를 보낸다.
3. 쿠키와 함께 다음 요청 시 서버에서는 클라이언트가 누군지 식별이 가능하게 된다.

## 세션

웹 사이트에 이용되는 정보를 서버에 저장하는 방법이다.

사용자가 로그인하면 서버는 세션 ID를 생성하고 이를 사용하여 사용자의 상태를 추적합니다.

단점

1. 유저 정보가 서버에 있어 처리 속도에 대한 비용 발생
2. 유저가 많아지면 저장 공간에 대한 비용 발생

따라서 쿠키와 세션의 가장 큰 차이점은 사용자의 정보가 저장되는 위치이다.

## 웹 스토리지

브라우저에 데이터를 저장할 수 있는 저장소이다.

특징으로는

1. 5MB 정보 저장 가능

2. 자동으로 서버에 전송되지 않음

3. 문자열만 저장 가능 (직렬화를 하면 객체 저장 가능)

## 웹 스토리지 종류

웹 스토리지 종류에는 로컬 스토리지와 세션 스토리지가 있습니다.

- 로컬 스토리지
  저장범위는 도메인 별로 저장을 하고 직접 삭제 시에 삭제가 된다.

사용 예시 : 글 임시 저장, 사용자 설정 저장

- 세션 스토리지
  저장범위는 도메인/탭 별로 저장을 하고 브라우저나 탭을 닫을 시 삭제가 된다.

사용 예시 : 입력폼 저장, 일회성 로그인

단점 : 만료 기간 설정 불가, 미지원하는 브라우저

TMI : TIL을 정리하면서 든 생각은 각각의 장단점이 있는데 이걸 보안적으로 생각했을때 어떻게 해야 "안전하게 사용할 수 있을까?" 라는 생각을 해봤을때는 정답이 없는것 같아서 이게 참 어려운것 같다.
